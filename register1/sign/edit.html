<!doctype html>
<html>
<head>
<meta charset="UTF-8">
<title>ฝ่ายสวัสดิการ ศึกษาศาสตร์ มหาวิทยาลัยนเรศวร 2562</title>
<meta name="author" content="iKenzz">
<meta name="description" content="ฝ่ายสวัสดิการ คณะศึกษาศาสตร์ มหาวิทยาลัยนเรศวร ปีการศึกษา 2562"/>
<link rel="shortcut icon" type="content/image/x-icon" href="content/favicon.ico">
<link rel="shortcut icon" type="content/image/png" href="content/favicon.png">
<!-- Facebook -->
<meta property="og:title" content="ฝ่ายสวัสดิการ ศึกษาศาสตร์ มหาวิทยาลัยนเรศวร 2562" />
<meta property="og:url" content="https://sevendays2018.github.io/edu-nu-2019-event/" />
<meta property="og:site_name" content="ฝ่ายสวัสดิการ ศึกษาศาสตร์ มหาวิทยาลัยนเรศวร 2562"/>
<meta property="og:description" content="ฝ่ายสวัสดิการ คณะศึกษาศาสตร์ มหาวิทยาลัยนเรศวร ปีการศึกษา 2562" />
<meta property="article:author" content="iKenzz" />
<meta property="article:publisher" content="https://www.facebook.com/groups/227791388117273/" />
<meta property="og:image" content="https://sevendays2018.github.io/edu-nu-2019-event/register1/content/og-image.jpg" />
	
<link rel="stylesheet" href="content/main.css" />
<link href="https://fonts.googleapis.com/css?family=Prompt:400,400i,500,500i|Sarabun:400,400i,600,600i" rel="stylesheet">
<script src="https://www.gstatic.com/firebasejs/5.7.2/firebase.js"></script>
<script>
  // Initialize Firebase
  var config = {
    apiKey: "AIzaSyC6x3egslw8y9UZVJS0gzfL7kP1xevQu4w",
    authDomain: "nu61410198-project.firebaseapp.com",
    databaseURL: "https://nu61410198-project.firebaseio.com",
    projectId: "nu61410198-project",
    storageBucket: "nu61410198-project.appspot.com",
    messagingSenderId: "1086891836879"
  };
  firebase.initializeApp(config);
  var database = firebase.database();
</script>
</head>

<body class="reportData">

	<script type="text/javascript">
		if (localStorage.getItem("editRef") != null) {
			var refCode = localStorage.getItem("editRef");
		} else {
			window.location = "index.html";
		}
	</script>
	
	<div class="reportData-background"></div>
	<div class="reportData-content">
		<div class="reportData-container">
			<div class="head">ตรวจสอบรายชื่อผู้ปฏิบัติงานฝ่ายสวัสดิการ</div>
			<div class="sub-head">คณะศึกษาศาสตร์ มหาวิทยาลัยนเรศวร ปีการศึกษา 2562</div>
			<div class="content">
				<center><div class="alert green" id="displayZone">
					<script type="text/javascript">
						var ref0 = firebase.database().ref('2019/education/event/regis1/sign/' + refCode + '/');
						var displayDate = new Date();
						ref0.on('value', function (snap) {
							var displayUpdate = snap.child('update').val();
							var displayEvent = snap.child('event').val();
							var displayDate = snap.child('date').val();
							var displayTime = snap.child('time').val();
							document.getElementById("displayZone").innerHTML = "กิจกรรม "+displayEvent+"<br>วันที่ "+displayDate+"&emsp;เวลา "+displayTime+"<br><span>*อัปเดตข้อมูลล่าสุด "+displayUpdate+"*</span>";
						});
					</script></div></center>

				<table width="100%" border="0" cellspacing="0" cellpadding="0">
  					<tbody id="textArea">
          
            					<script>		
			        			var ref1 = firebase.database().ref('2019/education/event/regis1/sign/' + refCode + '/staff' );
			        			var ref2 = firebase.database().ref('2019/education/event/regis1/sign/' + refCode + '/update');
							ref2.on('value', function (snap) {
                						document.getElementById('textArea').innerHTML = "<tr><td class='tableHead' width='15%'>รหัสนิสิต</td><td class='tableHead' width='35%'>ชื่อ-สกุล</td><td class='tableHead' width='25%'>ชื่อเล่น</td><td class='tableHead' width='25%'>สถานะ</td></tr>";
                						ref1.orderByChild('id').on('child_added', function (snap) {
                 							var refID = snap.child('/id').val();
                  							var refName = snap.child('/name').val();
                  							var refNickname = snap.child('/nickname').val();
                  							var refStatus = snap.child('/status').val();
											if (refStatus == "เข้าร่วม") {
												var addText = "<button class='orange' style='margin-top:10px; padding-top:2px; padding-bottom:2px; padding-left:7px; padding-right:7px;' onCLick='setOut(\""+refID+"\")'>ยกเลิกการเข้าร่วม</button>";
											} else {
												var addText = "<button class='green' style='margin-top:10px; padding-top:2px; padding-bottom:2px; padding-left:7px; padding-right:7px;' onCLick='setIn(\""+refID+"\")'>เข้าร่วม</button>";
											}
                 							if (refID != null) {
                    								var showData = "<tr><td width='15%'>" + refID + "</td><td width='35%'>" + refName + "</td><td width='25%'>" + refNickname + "</td><td width='25%'>" + addText + "</td></tr>";
                    								document.getElementById('textArea').innerHTML += showData;
                  							}
                						});
			        			});
            					</script>
            
  					</tbody>
				</table>

				<center>
					<div class="alert orange">
						เมื่อใช้งานระบบเสร็จสิ้น กรุณาออกจากระบบ<br><br>
						<form action="" onSubmit="return myForm()">
							<input type="submit" value="ออกจากระบบ" />
						</form>
					</div>
				</center>
			</div>
			<div class="footer">Powered by <a href="https://www.ktpstudioth.com">KTP Studio</a>.<br>©2019 by <a href="https://www.ikenzz.xyz">iKenzz</a>. All Rights Reserved.</div>
		</div>
	</div>
	
	<script type="text/javascript">
		function setIn(ref) {
			var nowDate = new Date();
			firebase.database().ref('2019/education/event/regis1/sign/'+refCode+'/staff/'+ref).update({
				status: "เข้าร่วม"
			});
			firebase.database().ref('2019/education/event/regis1/sign/'+refCode).update({
			update: nowDate
			});
			firebase.database().ref('2019/education/event/regis1/sign/').update({
			update: nowDate
			});
			var ref3 = firebase.database().ref('2019/education/event/regis1/sign/' + refCode);
			ref3.once('value', function (snap) {
				var counter = snap.child('/count').val();
				counter=counter+1;
				firebase.database().ref('2019/education/event/regis1/sign/'+refCode).update({
					count: counter
				});
			});
		}
		function setOut(ref) {
			var nowDate = new Date();
			firebase.database().ref('2019/education/event/regis1/sign/'+refCode+'/staff/'+ref).update({
				status: "ไม่เข้าร่วม"
			});
			firebase.database().ref('2019/education/event/regis1/sign/'+refCode).update({
			update: nowDate
			});
			firebase.database().ref('2019/education/event/regis1/sign/').update({
			update: nowDate
			});
			var ref3 = firebase.database().ref('2019/education/event/regis1/sign/' + refCode);
			ref3.once('value', function (snap) {
				var counter = snap.child('/count').val();
				counter=counter-1;
				firebase.database().ref('2019/education/event/regis1/sign/'+refCode).update({
					count: counter
				});
			});
		}
		function myForm() {
			localStorage.removeItem("editRef");
			alert("ออกจากระบบเรียบร้อยแล้ว");
			window.location = "index.html";
			return false;
		}
	</script>
	
</body>
</html>
